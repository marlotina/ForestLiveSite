<div class="row div-top-line  mb-15">
    <div class="col-9">
        <i class="align-middle mr-2 fas fa-fw fa-comment"></i> 
        <span class="aligned-with-icon">&nbsp;{{commentCount}}&nbsp;comments</span>
    </div>
</div>

<div class="row mb-15 padLRigth" *ngIf="userNameLogged != null">
    <div class="col-12 col-md-1">
        <img src="{{imagesProfileUrl}}{{userImage}}" alt="{{ 'postPage.userImage' | translate }}" 
            class="rounded-circle mr-1" alt="Kathie Burton" width="40" height="40">
    
        <label>{{userNameLogged}}</label>
    </div>
    <div class="col-12 col-md-11">
        <textarea class="form-control mb-15" #commentInput  
            name="text" id="text" cols="20" rows="3" 
            placeholder="{{ 'postPage.comment' | translate }}"></textarea>
        <button type="button" (click)="addComment(null, commentInput.value)" 
            class="btn btn-primary">{{ 'postPage.postComment' | translate }}</button>
    </div>
</div>

<div class="position-relative">
    <div class="chat-messages p-4">

        <ng-container
            *ngTemplateOutlet="replyThread; context: { $implicit: comments }"
    ></ng-container>

        
    </div>
</div>



<ng-template #replyThread let-childReplies>
    <div class="row mt-15 padLRigth" *ngFor="let comment of childReplies;">

        <div class="chat-message-right pb-4">
            <div *ngIf="comment.userId">
                <img src="{{imagesProfileUrl}}{{comment.userImage}}" alt="{{ 'postPage.userImage' | translate }}" 
                    class="rounded-circle me-1" width="40" height="40">
                <div class="text-muted small text-nowrap mt-2">{{comment.creationDate}}</div>
            </div>
            <div class="flex-shrink-1 bg-light rounded py-2 px-3 me-3">
                <div class="fw-bold mb-1">{{comment.userId}}</div>
                {{comment.text}}
            </div>
            <div *ngIf="userNameLogged != null && comment.userId">
                <button type="button" 
                    (click)="addVote(comment)" 
                    [ngClass]="{'hasVote-btn' : comment.hasVote, 'vote-btn' : !comment.hasVote}" 
                    class="votebtn">
                    <i class="align-middle mr-2 fas fa-fw fa-arrow-alt-circle-up"></i> 
                </button>
                &nbsp;Votes {{comment.voteCount}}&nbsp;
                <a class="badge bg-primary" data-bs-toggle="collapse" 
                    href="#collapseExample-{{comment.id}}" (click)="showCommentForm(comment.id)" 
                    role="button" aria-expanded="false" aria-controls="collapseExample">
                    Reply
                </a>

                <button *ngIf="showOwnerCommentOptions(comment.userId)" 
                    class="votebtn vote-btn"
                    mat-menu-item type="button" (click)="deleteComment(comment)">
                    
                    <i class="align-middle me-2 fas fa-fw fa-trash-alt"></i>
                </button>
                
                <div class="row">
                    <div class="collapse" id="collapseExample-{{comment.id}}">
                        <ng-container *ngIf="showFormList[comment.id]">
                            <ng-container
                            *ngTemplateOutlet="
                            commetForm;
                            context: { $implicit: comment }
                            "
                            ></ng-container>

                        </ng-container>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-12 col-md-12">
            <div class="row">
                <div *ngIf="comment.userId">
                    <a href="{{comment.userId}}" >
                        <img src="{{imagesProfileUrl}}{{comment.userImage}}" alt="{{ 'postPage.userImage' | translate }}" class="rounded-circle mr-1" alt="Kathie Burton" width="40" height="40">
                    </a>
                </div>
                <div class="padLRigth">

                    <div *ngIf="comment.userId" class="flex-shrink-1 bg-light rounded py-2 px-3 mr-3" >
                        <small >{{comment.userId}}&nbsp;<em>{{comment.creationDate}}</em></small>
                        <p>{{comment.text}}</p>
                    </div>

                    <div *ngIf="!comment.userId" class="flex-shrink-1 bg-light rounded py-2 px-3 mr-3 mb-15">
                        <p>el comentario fue borrado</p>
                    </div>

                    
                </div>   

                <ng-container *ngIf="comment.replies">
                    <ng-container
                    *ngTemplateOutlet="
                    replyThread;
                        context: { $implicit: comment.replies}
                    "
                    ></ng-container>
                </ng-container>
                
            </div>
        </div>
    </div>
</ng-template>

<ng-template #commetForm let-commentInfo>
    <div class="card card-body divPost">
        <div class="col-12 col-md-6 mb-15">
            <div class="form-group">
                <label>{{userNameLogged}}</label>
            </div>
        </div>
        <div class="col-12 mb-15">
            <div class="form-group">
                <textarea class="form-control" #titleInput  name="text" id="text" cols="30" rows="3" placeholder="{{ 'postPage.comment' | translate }}"></textarea>
            </div>
        </div>
        <div class="col-12 mb-15">
            <button type="button" (click)="addComment(commentInfo, titleInput.value)" class="btn btn-primary">{{ 'postPage.postComment' | translate }}</button>
        </div>
    </div>
</ng-template>